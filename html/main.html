<!DOCTYPE html>
<html>
    <head>
        <title>Mandelbrot Explorer</title>
        <!-- p5.js -->
        <script src="https://cdn.jsdelivr.net/npm/p5@1.1.9/lib/p5.js"></script>
        <script src="../js/sketch.js"></script>
        <script src="https://kit.fontawesome.com/38861b1f2d.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="../css/main.css">
        <link rel="stylesheet" href="../css/pseudocode.css">

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Jura&family=Montserrat+Alternates&display=swap" rel="stylesheet">  
    </head>
    <body>
        <h1>Mandelbrot Explorer</h1>

        <h2>Meet the Mandelbrot Set</h2>
        <pre id="mandelbrot-overview">
            <!-- will be populated by mandelbrot_overview.md-->
        </pre>

        <h2>Math of the Mandelbrot Set</h2>
        <pre id="mandelbrot-math">
            <!-- filled in  by mandelbrot_math.md -->
        </pre>

        <h2>Image Parameters</h2>
        <div id="params-box">
            <div id="max-iters-box">
                <button id="toggle-max-iters-info-btn" class="toggle-info-btn">
                    <i class="fas fa-angle-right"></i>
                </button>

                <label for="max-iters-input">Max Iterations</label>
                <br>
                <input type="number" id="max-iters-input" name="max-iters-input" value="10">
                <pre id="max-iters-info" class="info" hidden>
                    <!-- will be populated by max_iters_info.md -->
                </pre>
            </div>

            <hr>

            <div id="plotting-alg-box">
                <button id="toggle-plotting-alg-info-btn" class="toggle-info-btn">
                    <i class="fas fa-angle-right"></i>
                </button>

                <label for="plotting-alg-select">Plotting Algorithm</label>
                <br>
                <select name="plotting-alg-select" id="plotting-alg-select">
                    <option value="basic">Basic</option>
                    <option value="optimized_basic">Optimized Basic</option>
                    <option value="interior_dist">Interior Distance Estimate</option>
                    <option value="exterior_dist">Exterior Distance Estimate</option>
                    <option value="bulb_checking">Bulb Checking</option>
                    <option value="border_tracing">Border Tracing</option>
                    <option value="rectangle_checking">Rectangle Checking</option>
                    <option value="symmetry_utilization">Symmetry Utilization</option>
                    <option value="multithreaded">Multithreaded</option>
                    <option value="series_approx">Series Approximation</option>
                </select>

                <div class="bicolumn-container" id="plotting-alg-dropdown">
                    <div>
                        <pre id="plotting-alg-info" class="info">
                            <!-- will be populated by <algName>_info.md depending on which algorithm is selected -->
                        </pre>
                    </div>
                    
                    <hr class="vr">

                    <div>
                        <table class="pseudocode" id="plotting-alg-pseudo">
                            <!-- will be populated by <algName>_pseudo.txt depending on which algorithm is selected -->
                        </table>
                    </div>
                    
                </div>
            </div>

            <hr>

            <div id="coloring-alg-box">
                <button id="toggle-coloring-alg-info-btn" class="toggle-info-btn">
                    <i class="fas fa-angle-right"></i>
                </button>

                <label for="coloring-alg-select">Coloring Algorithm</label>
                <br>
                <select name="coloring-alg-select" id="coloring-alg-select">
                    <option value="escape">Escape Time</option>
                    <option value="histogram">Histogram</option>
                    <option value="smooth">Smooth</option>
                </select>

                <div class="bicolumn-container" id="coloring-alg-dropdown">
                    <div>
                        <pre id="coloring-alg-info" class="info">
                            <!-- will be populated by <algName>_info.md depending on which algorithm is selected -->
                        </pre>
                    </div>

                    <hr class="vr">
                    
                    <div>
                        <table class="pseudocode" id="coloring-alg-pseudo">
                            <!-- will be populated by <algName>_pseudo.md depending on which algorithm is selected -->
                        </table>
                    </div>
                </div>
            </div>

            <hr>
                
            <div id="boundary-box">
                <button id="toggle-boundary-info-btn" class="toggle-info-btn">
                    <i class="fas fa-angle-right"></i>
                </button>
                <label>Image Boundaries</label>

                <br>
                <div class="bicolumn-container">
                    <div>
                        <div>
                            <input type="number" id="re-lower-input" name="re-lower-input" value="-2.05" step="0.05">
                            <br>
                            <label for="re-lower-input" class="sublabel">Real Lower Bound</label>
                        </div>
                        <div>
                            <input type="number" id="re-upper-input" name="re-upper-input" value="0.8" step="0.05">
                            <br>
                            <label for="re-upper-input" class="sublabel">Real Upper Bound</label>
                        </div>
                    </div>

                    <hr class="vr">

                    <div>
                        <div>
                            <input type="number" id="im-lower-input" name="im-lower-input" value="-1.45" step="0.05">
                            <br>
                            <label for="im-lower-input" class="sublabel">Imaginary Lower Bound</label>
                        </div>
                        <div>
                            <input type="number" id="im-upper-input" name="im-upper-input" value="1.45" step="0.05">
                            <br>
                            <label for="im-upper-input" class="sublabel">Imaginary Upper Bound</label>
                        </div>
                    </div>    
                </div>

                <pre id="boundary-info" class="info" hidden>
                    <!-- will be populated by boundary_info.md -->
                </pre>
            </div>

        </div>

        <button id="draw-btn">Draw</button>
        <button type="reset">Reset</button>


        <!-- for the p5.js drawing -->
        <div id="canvas-holder" hidden></div>
    </body>

    <script>
        const ipcRenderer = require('electron').ipcRenderer;
        const fs = require('fs');
        const path = require('path');
        const lineReader = require('line-reader');

        const infoBaseDir = path.join(process.cwd(), 'static', 'info');
        const pseudocodeBaseDir = path.join(process.cwd(), 'static', 'pseudocode');

        document.addEventListener('DOMContentLoaded', () => {
            // TODO: add buttons to show/hide each of these info boxes
            // populate text sections appropriately
            let mandelbrotOverview = document.getElementById('mandelbrot-overview');
            mandelbrotOverview.innerHTML = fs.readFileSync(path.join(infoBaseDir, 'mandelbrot_overview.md'));
            let mandelbrotMath = document.getElementById('mandelbrot-math');
            mandelbrotMath.innerHTML = fs.readFileSync(path.join(infoBaseDir, 'mandelbrot_math.md'));

            /* max iterations parameter */
            let maxItersInfo = document.getElementById('max-iters-info');
            maxItersInfo.innerHTML = fs.readFileSync(path.join(infoBaseDir, 'max_iters_info.md'));
            let toggleMaxItersInfoBtn = document.getElementById('toggle-max-iters-info-btn');
            let toggleMaxItersIcon = document.querySelector('#toggle-max-iters-info-btn i')
            toggleMaxItersInfoBtn.addEventListener('click', () => {
                maxItersInfo.hidden = !(maxItersInfo.hidden);
                if (toggleMaxItersIcon.classList.contains('fa-angle-right')) {
                    toggleMaxItersIcon.classList.remove('fa-angle-right');
                    toggleMaxItersIcon.classList.add('fa-angle-down');
                } else {
                    toggleMaxItersIcon.classList.remove('fa-angle-down');
                    toggleMaxItersIcon.classList.add('fa-angle-right');
                }
            });


            /* plotting algorithm parameter */
            let togglePlottingAlgInfoBtn = document.getElementById('toggle-plotting-alg-info-btn');
            let togglePlottingAlgInfoIcon = document.querySelector('#toggle-plotting-alg-info-btn i');
            let plottingAlgDropdown = document.getElementById('plotting-alg-dropdown');
            let plottingAlgInfo = document.getElementById('plotting-alg-info');
            let plottingAlgPseudo = document.getElementById('plotting-alg-pseudo');
            let plottingAlgSelect = document.getElementById('plotting-alg-select');

            // initial population of info paragraph and pseudocode table
            let selectedPlottingAlg = plottingAlgSelect.value;
            // for the paragraph
            let currentPlottingAlgInfoContent = fs.readFileSync(path.join(infoBaseDir, selectedPlottingAlg + '_info.md'));
            plottingAlgInfo.innerHTML = currentPlottingAlgInfoContent;
            // for the pseudocode
            populatePseudoCodeTable(plottingAlgPseudo, path.join(pseudocodeBaseDir, selectedPlottingAlg + '_pseudo.txt'));

            // update the paragraph and pseudocode table when the selected algorithm changes
            plottingAlgSelect.addEventListener('input', () => {
                selectedPlottingAlg = plottingAlgSelect.value;

                // change info paragraph
                currentPlottingAlgInfoContent = plottingAlgInfo.innerHTML = fs.readFileSync(path.join(infoBaseDir, selectedPlottingAlg + '_info.md'));
                plottingAlgInfo.innerHTML = currentPlottingAlgInfoContent;

                // change the pseudocode
                populatePseudoCodeTable(plottingAlgPseudo, path.join(pseudocodeBaseDir, selectedPlottingAlg + '_pseudo.txt'));
            });
        
            // toggle the display of information about the selected algorithm
            togglePlottingAlgInfoBtn.addEventListener('click', () => {
                if (plottingAlgDropdown.style.display === '') {
                    plottingAlgDropdown.style.display = 'flex';
                } else {
                    plottingAlgDropdown.style.display = '';
                }
                if (togglePlottingAlgInfoIcon.classList.contains('fa-angle-right')) {
                    togglePlottingAlgInfoIcon.classList.remove('fa-angle-right');
                    togglePlottingAlgInfoIcon.classList.add('fa-angle-down');
                } else {
                    togglePlottingAlgInfoIcon.classList.remove('fa-angle-down');
                    togglePlottingAlgInfoIcon.classList.add('fa-angle-right');
                }
            });


            /* coloring algorithm parameter */
            let toggleColoringAlgInfoBtn = document.getElementById('toggle-coloring-alg-info-btn');
            let toggleColoringAlgInfoIcon = document.querySelector('#toggle-coloring-alg-info-btn i');
            let coloringAlgDropdown = document.getElementById('coloring-alg-dropdown');
            let coloringAlgInfo = document.getElementById('coloring-alg-info');
            let coloringAlgPseudo = document.getElementById('coloring-alg-pseudo');
            let coloringAlgSelect = document.getElementById('coloring-alg-select');
            
            // initial population of info paragraph and pseudocode table
            let selectedColoringAlg = coloringAlgSelect.value;
            // for the paragraph
            let currentColoringAlgInfoContent = fs.readFileSync(path.join(infoBaseDir, selectedColoringAlg + '_info.md'));
            coloringAlgInfo.innerHTML = currentColoringAlgInfoContent;
            // for the pseudocode
            populatePseudoCodeTable(coloringAlgPseudo, path.join(pseudocodeBaseDir, selectedColoringAlg + '_pseudo.txt'));

            // update the paragraph and pseudocode table when the selected algorithm changes
            coloringAlgSelect.addEventListener('input', () => {
                selectedColoringAlg = coloringAlgSelect.value;

                // change the info paragraph
                currentColoringAlgInfoContent = coloringAlgInfo.innerHTML = fs.readFileSync(path.join(infoBaseDir, selectedColoringAlg + '_info.md'));
                coloringAlgInfo.innerHTML = currentColoringAlgInfoContent;

                // change the pseudocode
                populatePseudoCodeTable(coloringAlgPseudo, path.join(pseudocodeBaseDir, selectedColoringAlg + '_pseudo.txt'));
            });
        
            // toggle the display of information about the selected algorithm
            toggleColoringAlgInfoBtn.addEventListener('click', () => {
                if (coloringAlgDropdown.style.display === '') {
                    coloringAlgDropdown.style.display = 'flex';
                } else {
                    coloringAlgDropdown.style.display = '';
                }
                if (toggleColoringAlgInfoIcon.classList.contains('fa-angle-right')) {
                    toggleColoringAlgInfoIcon.classList.remove('fa-angle-right');
                    toggleColoringAlgInfoIcon.classList.add('fa-angle-down');
                } else {
                    toggleColoringAlgInfoIcon.classList.remove('fa-angle-down');
                    toggleColoringAlgInfoIcon.classList.add('fa-angle-right');
                }
            });


            /* image boundary parameter */
            let boundaryInfo = document.getElementById('boundary-info');
            boundaryInfo.innerHTML = fs.readFileSync(path.join(infoBaseDir, 'boundary_info.md'));
            let toggleBoundaryInfoBtn = document.getElementById('toggle-boundary-info-btn');
            let toggleBoundaryIcon = document.querySelector('#toggle-boundary-info-btn i')
            toggleBoundaryInfoBtn.addEventListener('click', () => {
                boundaryInfo.hidden = !(boundaryInfo.hidden);
                if (toggleBoundaryIcon.classList.contains('fa-angle-right')) {
                    toggleBoundaryIcon.classList.remove('fa-angle-right');
                    toggleBoundaryIcon.classList.add('fa-angle-down');
                } else {
                    toggleBoundaryIcon.classList.remove('fa-angle-down');
                    toggleBoundaryIcon.classList.add('fa-angle-right');
                }
            });
        });

        // tableNode is the DOM element of the table which is to be cleared
        function clearPseudocodeTable(tableNode) {
            Array.from(tableNode.children).forEach(child => {
                child.remove();
            });
        }

        // tableNode is the DOM element of the table which is to be cleared
        // filePath is the path to load the source file from
        function populatePseudoCodeTable(tableNode, filePath) {
            clearPseudocodeTable(tableNode);

            let lineNum = 1;
            lineReader.eachLine(filePath, line => {
                let newRow = document.createElement("tr");

                let lineNumData = document.createElement("td");
                lineNumData.setAttribute("class", "line-num");
                lineNumData.textContent = lineNum++;
                newRow.appendChild(lineNumData);

                let lineContent = document.createElement("td");
                let lineContentPre = document.createElement("pre");  // to get code indentation
                lineContentPre.textContent = line;
                lineContent.appendChild(lineContentPre);
                newRow.appendChild(lineContent);

                tableNode.appendChild(newRow);
            });
        }
    </script>
</html>